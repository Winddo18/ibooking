name: CI/CD

on:
  push:
    branches:
      - master  # 指定触发工作流的分支

jobs:
  build:
    runs-on: ubuntu-latest  # 使用 GitHub 提供的 Ubuntu 环境

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3  # 检出代码

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.8'  # 设置 Python 版本

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # 安装依赖

      - name: Run tests
        run: |
          python manage.py test  # 运行测试

      - name: Build and deploy
        uses: easingthemes/ssh-deploy@v2.0.7  # 使用 SSH 部署
        env:
          SSH_PRIVATE_KEY: "Fudan123456"
          REMOTE_USER: "root"  # 服务器用户名
          REMOTE_HOST: "47.97.50.93"  # 服务器 IP
          TARGET: "/root"  # 服务器目标目录
